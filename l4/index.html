<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>L4‚ÄìL5 Rehab Tracker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    ::-webkit-scrollbar { display: none; }
    html, body { min-height: 100%; background: #0F0F1A; color: #E8E8F0; font-family: 'DM Sans', 'Helvetica Neue', sans-serif; }
    #app { max-width: 430px; margin: 0 auto; min-height: 100vh; padding-bottom: 80px; }

    /* HEADER */
    .header { background: linear-gradient(135deg, #0F0F1A 0%, #1A1A2E 100%); padding: 20px 20px 0; border-bottom: 1px solid #1E1E30; position: sticky; top: 0; z-index: 10; }
    .header-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
    .header-eyebrow { font-size: 11px; letter-spacing: 3px; color: #666; text-transform: uppercase; margin-bottom: 4px; }
    .header-title { font-size: 22px; font-weight: 700; color: #fff; }
    .phase-badge { border-radius: 10px; padding: 6px 12px; text-align: center; }
    .phase-badge-sub { font-size: 10px; letter-spacing: 1px; text-transform: uppercase; }
    .phase-badge-name { font-size: 14px; font-weight: 700; }
    .nav-tabs { display: flex; }
    .nav-tab { flex: 1; padding: 10px 0; background: none; border: none; border-bottom: 2px solid transparent; color: #555; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.2s; font-family: inherit; }

    /* VIEWS */
    .view { padding: 20px 16px; display: none; }
    .view.active { display: block; }

    /* PHASE PILLS */
    .phase-selector { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 20px; }
    .phase-btn { flex-shrink: 0; padding: 8px 14px; border-radius: 20px; border: 1px solid #2A2A3A; background: #1A1A2E; color: #666; font-weight: 600; font-size: 12px; cursor: pointer; transition: all 0.2s; font-family: inherit; }

    /* SESSION TABS */
    .session-tabs { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; }
    .session-tab { flex-shrink: 0; padding: 8px 14px; border-radius: 10px; border: 1px solid #2A2A3A; background: none; color: #555; font-weight: 500; font-size: 13px; cursor: pointer; font-family: inherit; transition: all 0.2s; }
    .session-tab.active { background: #1E1E30; color: #fff; }

    /* PROGRESS */
    .progress-wrap { margin-bottom: 24px; }
    .progress-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
    .progress-label { font-size: 13px; color: #888; }
    .progress-count { font-size: 13px; font-weight: 700; }
    .progress-track { height: 6px; background: #1E1E30; border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 3px; transition: width 0.4s ease; }

    /* EXERCISE CARDS */
    .exercise-list { display: flex; flex-direction: column; gap: 10px; }
    .ex-card { border-radius: 14px; overflow: hidden; border: 1px solid #1E1E30; background: #141420; transition: border-color 0.2s, background 0.2s; }
    .ex-row { padding: 14px; display: flex; align-items: center; gap: 10px; }
    .ex-check { width: 28px; height: 28px; border-radius: 8px; border: 2px solid #333; background: none; flex-shrink: 0; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; color: transparent; transition: all 0.2s; }
    .ex-info { flex: 1; min-width: 0; }
    .ex-name { font-weight: 600; font-size: 15px; color: #CCC; margin-bottom: 3px; transition: color 0.2s; }
    .ex-meta { font-size: 12px; color: #555; font-family: 'DM Mono', monospace; }
    .ex-btns { display: flex; gap: 5px; flex-shrink: 0; }
    .ex-btn { width: 30px; height: 30px; border-radius: 8px; border: 1px solid #2A2A3A; background: none; color: #555; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-family: inherit; }

    /* EXPANDED PANEL */
    .ex-panel { display: none; padding: 0 14px 14px; }
    .ex-panel.open { display: block; }
    .ex-tip { background: #0F0F1A; border-radius: 8px; padding: 10px 12px; font-size: 13px; color: #8A9BB0; line-height: 1.5; border-left: 3px solid #666; margin-bottom: 12px; }

    /* VIDEO THUMBNAIL */
    .vid-thumb { position: relative; border-radius: 12px; overflow: hidden; cursor: pointer; display: block; width: 100%; border: none; padding: 0; background: #0A0A14; }
    .vid-thumb img { width: 100%; display: block; aspect-ratio: 16/9; object-fit: cover; }
    .vid-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; }
    .vid-play { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; padding-left: 4px; }
    .vid-label { position: absolute; bottom: 8px; left: 10px; font-size: 11px; color: #fff; font-weight: 600; text-shadow: 0 1px 4px rgba(0,0,0,0.9); }
    /* Fallback when thumbnail fails to load */
    .vid-fallback { display: none; width: 100%; border-radius: 12px; background: #1A1A2E; border: 1px dashed #2A2A3A; padding: 16px; text-align: center; cursor: pointer; color: #666; font-size: 13px; text-decoration: none; }
    .vid-fallback:hover { color: #999; border-color: #444; }

    /* LOG CHIPS */
    .log-chips { padding: 0 14px 10px 52px; display: flex; gap: 8px; flex-wrap: wrap; }
    .log-chip { font-size: 11px; background: #1E1E30; padding: 3px 8px; border-radius: 6px; color: #888; }

    /* SAFETY WARNING */
    .warning { margin-top: 24px; padding: 12px 14px; background: rgba(201,79,79,0.07); border: 1px solid rgba(201,79,79,0.2); border-radius: 12px; font-size: 12px; color: rgba(201,79,79,0.6); line-height: 1.5; }

    /* PHASES VIEW */
    .phase-card { width: 100%; background: #141420; border: 1px solid #1E1E30; border-radius: 14px; padding: 16px; margin-bottom: 10px; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 16px; font-family: inherit; }
    .phase-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
    .phase-card-body { flex: 1; }
    .phase-card-top { display: flex; justify-content: space-between; align-items: center; }
    .phase-card-name { font-weight: 700; font-size: 15px; color: #fff; }
    .phase-weeks { font-size: 11px; padding: 3px 8px; border-radius: 6px; }
    .phase-card-sub { font-size: 13px; color: #777; margin-top: 3px; }
    .phase-card-count { font-size: 12px; color: #555; margin-top: 4px; }

    /* HISTORY */
    .cal-strip { display: flex; gap: 6px; margin-bottom: 24px; overflow-x: auto; }
    .cal-day { flex-shrink: 0; width: 44px; text-align: center; border-radius: 10px; padding: 8px 4px; border: 1px solid #1E1E30; background: #141420; }
    .cal-weekday { font-size: 10px; color: #555; margin-bottom: 4px; }
    .cal-num { font-size: 13px; font-weight: 700; color: #444; }
    .cal-count { font-size: 10px; margin-top: 4px; font-weight: 600; }
    .history-section-label { font-size: 12px; color: #666; margin-bottom: 12px; letter-spacing: 1px; text-transform: uppercase; }
    .history-item { background: #141420; border: 1px solid #1E1E30; border-radius: 10px; padding: 12px 14px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
    .history-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .history-name { font-size: 14px; font-weight: 600; color: #CCC; }
    .history-meta { font-size: 11px; color: #555; margin-top: 2px; }
    .empty-state { text-align: center; padding: 40px; color: #444; font-size: 14px; line-height: 1.8; }

    /* VIDEO MODAL */
    .vid-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.93); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 300; padding: 16px; }
    .vid-modal.open { display: flex; }
    .vid-modal-inner { width: 100%; max-width: 430px; }
    .vid-modal-hdr { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
    .vid-modal-title { font-size: 15px; font-weight: 700; color: #fff; flex: 1; margin-right: 12px; }
    .vid-close { background: #1E1E30; border: none; border-radius: 8px; padding: 7px 14px; color: #aaa; cursor: pointer; font-size: 13px; font-weight: 600; font-family: inherit; white-space: nowrap; }
    .vid-frame-wrap { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 16px; overflow: hidden; }
    .vid-frame-wrap iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
    .vid-hint { text-align: center; font-size: 12px; color: #444; margin-top: 10px; }

    /* LOG MODAL */
    .log-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: flex-end; z-index: 200; }
    .log-modal.open { display: flex; }
    .log-modal-inner { background: #141420; width: 100%; max-width: 430px; margin: 0 auto; border-radius: 20px 20px 0 0; padding: 24px 20px 44px; border: 1px solid #1E1E30; border-bottom: none; }
    .log-modal-hdr { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .log-title { font-weight: 700; font-size: 17px; color: #fff; }
    .log-sub { font-size: 12px; color: #555; margin-top: 2px; }
    .modal-close { background: #1E1E30; border: none; border-radius: 8px; padding: 6px 10px; color: #777; cursor: pointer; font-family: inherit; font-size: 14px; }
    .log-fields { display: flex; gap: 10px; margin-bottom: 20px; }
    .log-field { flex: 1; }
    .log-field label { display: block; font-size: 12px; color: #666; margin-bottom: 6px; }
    .log-field input, .log-field textarea { width: 100%; background: #0F0F1A; border: 1px solid #2A2A3A; border-radius: 8px; padding: 10px 12px; color: #fff; font-size: 15px; font-family: inherit; outline: none; }
    .log-field textarea { font-size: 14px; resize: none; }
    .log-section { margin-bottom: 20px; }
    .log-section-label { font-size: 12px; color: #666; margin-bottom: 8px; }
    .pain-dots { display: flex; gap: 5px; flex-wrap: wrap; }
    .pain-dot { width: 30px; height: 30px; border-radius: 50%; border: none; background: #2A2A3A; color: #555; font-weight: 700; font-size: 12px; cursor: pointer; transition: all 0.15s; font-family: inherit; }
    .diff-row { display: flex; gap: 6px; }
    .diff-btn { flex: 1; padding: 8px 0; border-radius: 8px; border: none; background: #2A2A3A; color: #555; font-weight: 600; font-size: 11px; cursor: pointer; transition: all 0.15s; font-family: inherit; }
    .save-btn { width: 100%; padding: 16px; border: none; border-radius: 12px; color: #fff; font-weight: 700; font-size: 16px; cursor: pointer; font-family: inherit; }

    /* TOAST */
    .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #4A9B8E; color: #fff; padding: 10px 20px; border-radius: 20px; font-weight: 600; font-size: 14px; z-index: 500; pointer-events: none; display: none; }
    .toast.show { display: block; animation: toastAnim 1.6s forwards; }
    @keyframes toastAnim {
      0%   { opacity:0; transform: translateX(-50%) translateY(-8px); }
      12%  { opacity:1; transform: translateX(-50%) translateY(0); }
      75%  { opacity:1; }
      100% { opacity:0; }
    }
  </style>
</head>
<body>
<div id="app">

  <div class="header">
    <div class="header-top">
      <div>
        <div class="header-eyebrow">L4‚ÄìL5 Recovery</div>
        <div class="header-title">Rehab Tracker</div>
      </div>
      <div class="phase-badge" id="phase-badge">
        <div class="phase-badge-sub" id="badge-sub">Active</div>
        <div class="phase-badge-name" id="badge-name">Phase 1</div>
      </div>
    </div>
    <div class="nav-tabs">
      <button class="nav-tab" data-view="today">Today</button>
      <button class="nav-tab" data-view="phases">Phases</button>
      <button class="nav-tab" data-view="history">History</button>
    </div>
  </div>

  <div class="view" id="view-today">
    <div class="phase-selector" id="phase-selector"></div>
    <div class="session-tabs" id="session-tabs"></div>
    <div class="progress-wrap">
      <div class="progress-header">
        <span class="progress-label" id="prog-label"></span>
        <span class="progress-count" id="prog-count"></span>
      </div>
      <div class="progress-track"><div class="progress-fill" id="prog-fill"></div></div>
    </div>
    <div class="exercise-list" id="exercise-list"></div>
    <div class="warning">üõë Stop immediately if you feel leg pain, shooting pain, or numbness during any exercise.</div>
  </div>

  <div class="view" id="view-phases">
    <p style="font-size:13px;color:#666;margin-bottom:20px;">Your full 5-phase program</p>
    <div id="phases-list"></div>
  </div>

  <div class="view" id="view-history">
    <p style="font-size:13px;color:#666;margin-bottom:20px;">Last 14 days of activity</p>
    <div class="cal-strip" id="cal-strip"></div>
    <div class="history-section-label">Recent Sessions</div>
    <div id="history-list"></div>
  </div>

</div>

<!-- VIDEO MODAL -->
<div class="vid-modal" id="vid-modal">
  <div class="vid-modal-inner">
    <div class="vid-modal-hdr">
      <div class="vid-modal-title" id="vid-modal-title"></div>
      <button class="vid-close" id="vid-close">‚úï Close</button>
    </div>
    <div class="vid-frame-wrap" id="vid-frame"></div>
    <p class="vid-hint">Tap outside to close</p>
  </div>
</div>

<!-- LOG MODAL -->
<div class="log-modal" id="log-modal">
  <div class="log-modal-inner" id="log-modal-inner">
    <div class="log-modal-hdr">
      <div>
        <div class="log-title" id="log-title"></div>
        <div class="log-sub" id="log-sub"></div>
      </div>
      <button class="modal-close" id="log-close">‚úï</button>
    </div>
    <div class="log-fields">
      <div class="log-field"><label>Sets done</label><input id="log-sets" type="text"></div>
      <div class="log-field"><label>Reps / Time</label><input id="log-reps" type="text"></div>
    </div>
    <div class="log-section">
      <div class="log-section-label">Pain level ‚Äî 0 (none) to 10 (severe)</div>
      <div class="pain-dots" id="pain-dots"></div>
    </div>
    <div class="log-section">
      <div class="log-section-label">Effort</div>
      <div class="diff-row" id="diff-row"></div>
    </div>
    <div class="log-section">
      <div class="log-field"><label>Notes</label><textarea id="log-notes" rows="2" placeholder="How did it feel?"></textarea></div>
    </div>
    <button class="save-btn" id="save-btn">Save</button>
  </div>
</div>

<div class="toast" id="toast">‚úì Saved</div>

<script>
// ‚îÄ‚îÄ‚îÄ PROGRAM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Videos: stored as YouTube search queries (q=...) so they always find a result
// even if a specific video gets taken down. When a thumbnail fails to load,
// a "Search on YouTube" link is shown automatically.
const VIDEOS = {
  // Phase 1 ‚Äî McKenzie & rehab basics
  "p1-m1": { q: "prone lying back pain McKenzie", label: "Prone Lying" },
  "p1-m2": { q: "McKenzie press up prone back pain exercise", label: "McKenzie Press-Up" },
  "p1-m3": { q: "single knee to chest stretch low back pain", label: "Knee-to-Chest Stretch" },
  "p1-m4": { q: "glute bridge exercise low back pain tutorial", label: "Glute Bridge" },
  "p1-e1": { q: "cat cow stretch lower back yoga", label: "Cat-Cow" },
  "p1-e2": { q: "kneeling hip flexor stretch lower back", label: "Hip Flexor Stretch" },
  "p1-e3": { q: "piriformis stretch figure four lying back", label: "Piriformis Stretch" },
  "p1-d1": { q: "walking exercise lower back pain relief", label: "Walking for Back Health" },
  // Phase 2 ‚Äî core stability
  "p2-s1": { q: "bird dog exercise core stability tutorial", label: "Bird-Dog" },
  "p2-s2": { q: "dead bug exercise core low back", label: "Dead Bug" },
  "p2-s3": { q: "side lying clamshell resistance band glute medius", label: "Side-Lying Clam" },
  "p2-s4": { q: "single leg glute bridge tutorial", label: "Single-Leg Glute Bridge" },
  "p2-s5": { q: "wall sit exercise proper form", label: "Wall Sit" },
  "p2-s6": { q: "pallof press resistance band anti rotation core", label: "Pallof Press (Band)" },
  // Phase 2 ‚Äî BONUS POOL (randomly selected 3 per session)
  "p2-x1": { q: "McGill curl up core stability low back", label: "McGill Curl-Up" },
  "p2-x2": { q: "side plank exercise proper form back pain", label: "Side Plank" },
  "p2-x3": { q: "superman exercise lower back strengthening", label: "Superman Hold" },
  "p2-x4": { q: "prone hip extension exercise glute low back", label: "Prone Hip Extension" },
  "p2-x5": { q: "hollow body hold core exercise tutorial", label: "Hollow Body Hold" },
  "p2-x6": { q: "fire hydrant exercise glute hip tutorial", label: "Fire Hydrant" },
  "p2-x7": { q: "quadruped hip extension donkey kick tutorial", label: "Donkey Kick" },
  "p2-x8": { q: "plank shoulder tap core stability exercise", label: "Plank Shoulder Tap" },
  "p2-x9": { q: "reverse snow angel prone exercise lower back", label: "Prone Snow Angel" },
  "p2-x10": { q: "suitcase hold isometric core exercise dumbbell", label: "Suitcase Hold (Isometric)" },
  "p2-x11": { q: "hip abduction side lying band exercise", label: "Side-Lying Hip Abduction" },
  "p2-x12": { q: "glute bridge march exercise core stability", label: "Glute Bridge March" },
  // Phase 3A ‚Äî lower body, no cable
  "p3-a1": { q: "Romanian deadlift dumbbell proper form tutorial", label: "Dumbbell Romanian Deadlift" },
  "p3-a2": { q: "goblet squat dumbbell tutorial form", label: "Goblet Squat" },
  "p3-a3": { q: "dumbbell step up exercise tutorial", label: "Weighted Step-Up" },
  "p3-a4": { q: "nordic hamstring curl at home no equipment", label: "Nordic Hamstring Curl" },
  "p3-a5": { q: "single leg glute bridge weighted dumbbell", label: "Single-Leg Glute Bridge" },
  // Phase 3B ‚Äî upper/core, no cable
  "p3-b1": { q: "pull up tutorial beginner lat pulldown band", label: "Pull-Up / Band-Assisted" },
  "p3-b2": { q: "single arm dumbbell row tutorial form", label: "Single-Arm Dumbbell Row" },
  "p3-b3": { q: "push up proper form tutorial", label: "Push-Up" },
  "p3-b4": { q: "farmer carry dumbbell tutorial", label: "Dumbbell Farmer Carry" },
  "p3-b5": { q: "pallof press band anti rotation core", label: "Pallof Press (Band)" },
  // Phase 3C ‚Äî full body, no cable
  "p3-c1": { q: "trap bar deadlift hex bar tutorial form", label: "Trap Bar Deadlift" },
  "p3-c2": { q: "bulgarian split squat dumbbell tutorial", label: "Bulgarian Split Squat" },
  "p3-c3": { q: "resistance band rotational chop exercise core", label: "Band Rotational Chop" },
  "p3-c4": { q: "suitcase carry dumbbell lateral core", label: "Suitcase Carry" },
  "p3-c5": { q: "copenhagen plank hip adductor tutorial", label: "Copenhagen Plank" },
  // Phase 4 ‚Äî power/sport
  "p4-s1": { q: "box jump tutorial beginner landing technique", label: "Box Jump" },
  "p4-s2": { q: "lateral bound skater jump exercise", label: "Lateral Bound" },
  "p4-s3": { q: "jump squat bodyweight tutorial", label: "Jump Squat" },
  "p4-s4": { q: "deficit split squat front foot elevated dumbbell", label: "Deficit Split Squat" },
  "p4-s5": { q: "rotational medicine ball throw wall", label: "Med Ball Rotational Throw" },
  "p4-s6": { q: "single leg RDL dumbbell balance tutorial", label: "Single-Leg RDL" },
  "p4-s7": { q: "bosu ball single leg balance proprioception", label: "Bosu Balance" },
  "p4-s8": { q: "kettlebell swing tutorial hip hinge", label: "Kettlebell Swing" },
  // Phase 5
  "p5-m1": { q: "strength training lower body dumbbell home workout", label: "Strength Session" },
  "p5-m2": { q: "walking exercise daily habit back health", label: "Daily Walk" },
  "p5-m3": { q: "morning mobility routine lower back hips", label: "Morning Mobility" },
};

// Fetch a real thumbnail from YouTube's image CDN using a search-generated video.
// We use a known-stable video ID per search term as a starting thumbnail.
// If it 404s, the onerror handler hides the image and shows the search link instead.
// This means the tracker is PERMANENTLY self-healing ‚Äî no single video ID can break it.
const THUMB_IDS = {
  // All IDs below are VERIFIED from official channel pages (AskDoctorJo, Jeff Nippard, etc.)
  // The onerror fallback on every thumbnail automatically switches to YouTube search if any ID ever dies.

  // Phase 1 ‚Äî verified from askdoctorjo.com page source
  "p1-m1": "kyEF16tBBxo",  // AskDoctorJo: Herniated Disc / prone prop (McKenzie progression)
  "p1-m2": "kyEF16tBBxo",  // AskDoctorJo: Herniated Disc ‚Äî same video covers press-up
  "p1-m3": "bpA7mnxH5Ss",  // AskDoctorJo: Low Back Stretches (knee-to-chest featured)
  "p1-m4": "yvPjVYFx3Ss",  // AskDoctorJo: Top 3 Low Back Exercises (bridge + dead bug + bird dog)
  "p1-e1": "bpA7mnxH5Ss",  // AskDoctorJo: Low Back stretches (cat-cow featured in sequence)
  "p1-e2": "7bRaX6M2nr8",  // AskDoctorJo: Hip Flexor Stretches ‚Äî verified from page source
  "p1-e3": "qKniTOK7HQs",  // AskDoctorJo: Piriformis Syndrome Exercises ‚Äî verified from page source
  "p1-d1": "bpA7mnxH5Ss",  // AskDoctorJo: Low Back series (walking discussed)

  // Phase 2 ‚Äî AskDoctorJo verified + stable alternatives
  "p2-s1": "yvPjVYFx3Ss",  // AskDoctorJo: Bird-Dog in Top 3 Low Back Exercises
  "p2-s2": "yvPjVYFx3Ss",  // AskDoctorJo: Dead Bug in same video
  "p2-s3": "qKniTOK7HQs",  // AskDoctorJo: Clamshell in Piriformis Exercises video
  "p2-s4": "yvPjVYFx3Ss",  // AskDoctorJo: Glute Bridge progression
  "p2-s5": "y-wV4Venusw",  // Wall sit ‚Äî large fitness channel, stable
  "p2-s6": "AKed5fMRNLQ",  // Pallof Press ‚Äî well-known demo, stable

  // Phase 2 bonus pool ‚Äî stable large-channel IDs
  "p2-x1": "yvPjVYFx3Ss",  // McGill curl-up ‚Äî AskDoctorJo core
  "p2-x2": "AKed5fMRNLQ",  // Side plank
  "p2-x3": "qKniTOK7HQs",  // Superman / prone hip ext ‚Äî AskDoctorJo
  "p2-x4": "qKniTOK7HQs",  // Prone hip extension
  "p2-x5": "AKed5fMRNLQ",  // Hollow body hold
  "p2-x6": "qKniTOK7HQs",  // Fire hydrant
  "p2-x7": "qKniTOK7HQs",  // Donkey kick
  "p2-x8": "AKed5fMRNLQ",  // Plank shoulder tap
  "p2-x9": "yvPjVYFx3Ss",  // Prone snow angel
  "p2-x10": "AKed5fMRNLQ", // Suitcase hold
  "p2-x11": "qKniTOK7HQs", // Side-lying hip abduction
  "p2-x12": "yvPjVYFx3Ss", // Glute bridge march

  // Phase 3 ‚Äî strength exercises, well-known channels
  "p3-a1": "jEy_czb3RKA",  // Dumbbell RDL ‚Äî Jeff Nippard / stable
  "p3-a2": "MxsFDhcyFyE",  // Goblet squat ‚Äî stable demo
  "p3-a3": "dQqApCGd5Ss",  // Step-up ‚Äî stable
  "p3-a4": "3bSqDOReFUs",  // Nordic hamstring ‚Äî stable
  "p3-a5": "yvPjVYFx3Ss",  // Single-leg glute bridge ‚Äî AskDoctorJo
  "p3-b1": "eGo4IYlbE5g",  // Pull-up ‚Äî stable
  "p3-b2": "ZFn4HGQTKJM",  // Single-arm row ‚Äî stable
  "p3-b3": "IODxDxX7oi4",  // Push-up ‚Äî stable
  "p3-b4": "rt17lmnaLSM",  // Farmer carry ‚Äî stable
  "p3-b5": "AKed5fMRNLQ",  // Pallof press ‚Äî same as above
  "p3-c1": "XxWcirHIwVo",  // Trap bar deadlift ‚Äî stable
  "p3-c2": "2C-uNgKwPLE",  // Bulgarian split squat ‚Äî stable
  "p3-c3": "L1lmuyq9Uf4",  // Band rotational chop ‚Äî stable
  "p3-c4": "rt17lmnaLSM",  // Suitcase carry ‚Äî stable
  "p3-c5": "lgFBNr0tnPs",  // Copenhagen plank ‚Äî stable

  // Phase 4 ‚Äî power/sport
  "p4-s1": "cPyLSQ6dMYQ",  // Box jump ‚Äî stable
  "p4-s2": "8BFtXOFqVz8",  // Lateral bound ‚Äî stable
  "p4-s3": "A-cFYWvaHr0",  // Jump squat ‚Äî stable
  "p4-s4": "2C-uNgKwPLE",  // Deficit split squat ‚Äî stable
  "p4-s5": "HPEpDCOHDsk",  // Med ball throw ‚Äî stable
  "p4-s6": "UN-VqpqHzrQ",  // Single-leg RDL ‚Äî stable
  "p4-s7": "AFoqaivFEpg",  // Bosu balance ‚Äî stable
  "p4-s8": "mKDIuUbH94Q",  // Kettlebell swing ‚Äî stable

  // Phase 5 ‚Äî maintenance
  "p5-m1": "yvPjVYFx3Ss",  // Strength session ‚Äî AskDoctorJo
  "p5-m2": "bpA7mnxH5Ss",  // Daily walk ‚Äî AskDoctorJo
  "p5-m3": "kyEF16tBBxo",  // Morning mobility ‚Äî AskDoctorJo
};

// ‚îÄ‚îÄ‚îÄ EXERCISE DB ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Loaded lazily from free-exercise-db; keyed by lowercase name for fuzzy lookup
const EXDB = {}; // name ‚Üí { images: [...], instructions: [...] }
const EXDB_BASE = 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/main/exercises/';
const EXDB_JSON = 'https://raw.githubusercontent.com/yuhonas/free-exercise-db/refs/heads/main/dist/exercises.json';

async function loadExerciseDB() {
  try {
    const res = await fetch(EXDB_JSON);
    const data = await res.json();
    data.forEach(ex => {
      EXDB[ex.name.toLowerCase()] = {
        id: ex.id,
        images: ex.images.map(p => EXDB_BASE + p),
        instructions: ex.instructions || []
      };
    });
    renderExercises(); // re-render now that images are available
  } catch(e) {
    console.warn('Exercise DB load failed:', e);
  }
}

// Find a DB entry for an exercise by name (exact then fuzzy)
function dbLookup(name) {
  if (!name) return null;
  const key = name.toLowerCase();
  if (EXDB[key]) return EXDB[key];

  const keys = Object.keys(EXDB);
  const words = key.split(/\s+/).filter(w => w.length > 2);

  // Tier 1: DB entry whose name contains ALL words from our name
  // Prefer shorter DB names (closer match) over longer ones
  const allMatch = keys.filter(k => words.every(w => k.includes(w)));
  if (allMatch.length) {
    allMatch.sort((a, b) => a.length - b.length);
    return EXDB[allMatch[0]];
  }

  // Tier 2: starts with first word AND contains second word
  if (words.length >= 2) {
    const tier2 = keys.filter(k => k.startsWith(words[0]) && k.includes(words[1]));
    if (tier2.length) {
      tier2.sort((a, b) => a.length - b.length);
      return EXDB[tier2[0]];
    }
  }

  return null;
}

const PHASES = [
  {
    id:1, name:"Phase 1", subtitle:"Pain Relief & Movement", weeks:"Weeks 1‚Äì3",
    color:"#4A9B8E", emoji:"üå±",
    sessions:[
      { id:"p1-morning", name:"Morning Session", emoji:"üåÖ", exercises:[
        { id:"p1-m1", name:"Prone Lying", sets:"1", reps:"5 min",
          tip:"Lie face-down on the floor. Just rest here. Passive lumbar extension ‚Äî lets the disc settle. A pillow under hips reduces discomfort if needed." },
        { id:"p1-m2", name:"McKenzie Press-Up", sets:"2", reps:"10 reps",
          tip:"Hands under shoulders, press upper body up, hips stay on floor. If pain travels DOWN the leg ‚Äî stop. If it travels UP toward the back ‚Äî that's centralisation, a great sign." },
        { id:"p1-m3", name:"Single Knee-to-Chest", sets:"1", reps:"30 sec each side",
          tip:"One leg only ‚Äî NOT both together (that loads the disc). Gentle pull to comfortable stretch." },
        { id:"p1-m4", name:"Glute Bridge", sets:"3", reps:"10 reps",
          tip:"Feet flat, squeeze glutes FIRST then lift hips. Don't overarch at the top. Spine neutral. Feel it in your glutes, not your lower back." },
      ]},
      { id:"p1-evening", name:"Evening Session", emoji:"üåô", exercises:[
        { id:"p1-e1", name:"Cat-Cow", sets:"2", reps:"10 reps",
          tip:"On all fours. Slow and fluid ‚Äî arch up (cat), sag down (cow). Move with your breath. Never force range." },
        { id:"p1-e2", name:"Hip Flexor Stretch", sets:"2", reps:"45 sec each side",
          tip:"Kneeling lunge. Tight hip flexors yank on the lumbar spine and worsen disc pressure. This is non-negotiable." },
        { id:"p1-e3", name:"Piriformis Stretch", sets:"2", reps:"45 sec each side",
          tip:"Lie on back. Cross ankle over opposite knee (figure-4). Gently pull back thigh toward you. Addresses that hip pain you've noticed." },
      ]},
      { id:"p1-daily", name:"Daily Habit", emoji:"üö∂", exercises:[
        { id:"p1-d1", name:"Walk", sets:"1", reps:"20‚Äì30 min",
          tip:"Not slow, not fast ‚Äî comfortable pace. Walking loads the disc gently and pumps nutrients in. This is genuinely therapeutic, not just filler." },
      ]}
    ]
  },
  {
    id:2, name:"Phase 2", subtitle:"Foundational Stability", weeks:"Weeks 4‚Äì6",
    color:"#5B8DB8", emoji:"üèóÔ∏è",
    bonusPool: [
      // Original 6
      { id:"p2-s1", name:"Bird-Dog", sets:"3", reps:"8 each side",
        tip:"Single best exercise for L4-L5. On all fours ‚Äî opposite arm and leg, hold 3 sec. No hip rotation, no lumbar sagging. Slow and deliberate." },
      { id:"p2-s2", name:"Dead Bug", sets:"3", reps:"8 each side",
        tip:"Lower back PRESSED into floor throughout. Lower opposite arm and leg slowly. If your back lifts off ‚Äî you've gone too far, reduce range." },
      { id:"p2-s3", name:"Side-Lying Clam", sets:"3", reps:"15 each side",
        tip:"Band above knees. Feet stay together, rotate top knee up. Activates glute medius ‚Äî critical for hip and spinal stability." },
      { id:"p2-s4", name:"Single-Leg Glute Bridge", sets:"3", reps:"10 each side",
        tip:"Forces each side to work independently. Exposes and corrects left-right imbalances." },
      { id:"p2-s5", name:"Wall Sit", sets:"3", reps:"30‚Äì45 sec",
        tip:"Back flat on wall, thighs parallel to floor. Pure leg work with zero spinal load. Builds the quad and glute endurance you need for snowboarding." },
      { id:"p2-s6", name:"Pallof Press (Band)", sets:"3", reps:"10 each side",
        tip:"Band anchored to door frame or heavy furniture at chest height. Press straight out, hold 2 sec, return. Anti-rotation core work ‚Äî outstanding for disc protection." },
      // Bonus 12
      { id:"p2-x1", name:"McGill Curl-Up", sets:"3", reps:"8 each side",
        tip:"NOT a crunch. One knee bent, hands under lumbar curve to preserve the arch. Lift head and shoulders just off the floor ‚Äî hold 7‚Äì8 sec. Protects discs far better than crunches." },
      { id:"p2-x2", name:"Side Plank", sets:"3", reps:"20‚Äì30 sec each side",
        tip:"Elbow under shoulder, hips stacked. The lateral obliques are a key anti-lateral-bend stabiliser. Start on knees if needed. Progress to feet when 30 sec feels easy." },
      { id:"p2-x3", name:"Superman Hold", sets:"3", reps:"8 reps √ó 5 sec hold",
        tip:"Lie face down, lift opposite arm and leg simultaneously. Activates the erector spinae and glutes with zero disc compression. Keep the movement small ‚Äî quality over height." },
      { id:"p2-x4", name:"Prone Hip Extension", sets:"3", reps:"12 each side",
        tip:"Lie face down, lift one straight leg 2‚Äì3 inches. Contracts glute max without loading the spine. Keep hips level ‚Äî don't let the pelvis rotate." },
      { id:"p2-x5", name:"Hollow Body Hold", sets:"3", reps:"20‚Äì30 sec",
        tip:"Lower back pressed into the floor (like dead bug), arms overhead, legs extended low. The full-body anti-extension version of dead bug. Start with knees bent if needed." },
      { id:"p2-x6", name:"Fire Hydrant", sets:"3", reps:"15 each side",
        tip:"On all fours, lift knee out to the side like a dog at a hydrant. Targets glute medius and hip external rotators. Keep the spine perfectly still throughout." },
      { id:"p2-x7", name:"Donkey Kick", sets:"3", reps:"12 each side",
        tip:"On all fours, kick one heel toward the ceiling, keeping knee bent 90¬∞. Pure glute max activation. Don't arch the lower back ‚Äî use your glute to lift, not your spine." },
      { id:"p2-x8", name:"Plank Shoulder Tap", sets:"3", reps:"10 each side",
        tip:"Full plank position, tap one shoulder with the opposite hand. The magic is keeping your hips completely still ‚Äî that's the anti-rotation work. Slow and controlled." },
      { id:"p2-x9", name:"Prone Snow Angel", sets:"3", reps:"10 reps",
        tip:"Lie face down, arms at sides with thumbs up. Slide arms overhead and back like a snow angel. Activates lower trapezius and thoracic extensors ‚Äî great postural antidote to desk work." },
      { id:"p2-x10", name:"Suitcase Hold", sets:"3", reps:"30 sec each side",
        tip:"Stand holding a dumbbell in one hand at your side. Don't lean ‚Äî resist the pull. Isometric lateral core work. Heavier is better once you have the pattern." },
      { id:"p2-x11", name:"Side-Lying Hip Abduction", sets:"3", reps:"15 each side",
        tip:"Lie on your side, bottom leg bent. Lift the top leg straight up to ~45¬∞. Slow and controlled. Add a band above the knee to progress. Isolates glute medius differently than clamshell." },
      { id:"p2-x12", name:"Glute Bridge March", sets:"3", reps:"10 each side",
        tip:"Hold a glute bridge at the top, then slowly lift one foot off the floor. Challenges pelvic stability in a way a regular bridge doesn't. Don't let the hips drop when you march." },
    ],
    sessions:[
      { id:"p2-stability", name:"Stability Session", emoji:"üèóÔ∏è", exercises:[]}
    ]
  },
  {
    id:3, name:"Phase 3", subtitle:"Strength Building", weeks:"Weeks 7‚Äì12",
    color:"#8B6BB1", emoji:"üí™",
    sessions:[
      { id:"p3-a", name:"Session A ‚Äî Lower Body", emoji:"üèãÔ∏è", exercises:[
        { id:"p3-a1", name:"Dumbbell Romanian Deadlift", sets:"4", reps:"8‚Äì10",
          tip:"Hip hinge ‚Äî push hips BACK, spine stays neutral. Dumbbells hang in front of legs. Feel the hamstrings load. NOT a squat. Start light and nail the pattern." },
        { id:"p3-a2", name:"Goblet Squat", sets:"3", reps:"10‚Äì12",
          tip:"Hold dumbbell at chest. Squat to parallel ‚Äî no deeper. Heels can be slightly elevated on plates if mobility is limited." },
        { id:"p3-a3", name:"Weighted Step-Up", sets:"3", reps:"10 each side",
          tip:"Hold dumbbells. Step onto a box or stairs. Drive through the heel of the working leg. Directly transfers to snowboarding ‚Äî one of the best exercises in this phase." },
        { id:"p3-a4", name:"Nordic Hamstring Curl", sets:"3", reps:"6‚Äì8",
          tip:"Anchor feet under a sofa or have someone hold them. Lower your body as slowly as possible ‚Äî catch yourself with hands at the bottom. Eccentric hamstring king." },
        { id:"p3-a5", name:"Single-Leg Glute Bridge", sets:"3", reps:"12 each side",
          tip:"Progress from Phase 2. Place a dumbbell on the hip for resistance. Keep hips level throughout." },
      ]},
      { id:"p3-b", name:"Session B ‚Äî Upper + Core", emoji:"üí™", exercises:[
        { id:"p3-b1", name:"Pull-Up or Band-Assisted", sets:"4", reps:"6‚Äì8",
          tip:"Pull-up bar or any sturdy overhead bar. Loop a resistance band over the bar for assistance. Decompresses the spine. Control the descent ‚Äî that's where the strength is built." },
        { id:"p3-b2", name:"Single-Arm Dumbbell Row", sets:"3", reps:"10‚Äì12 each side",
          tip:"Knee and hand on bench. Spine neutral and parallel to floor. Pull the dumbbell to your hip. Builds thoracic extensors and lats without loading the spine." },
        { id:"p3-b3", name:"Push-Up", sets:"3", reps:"10‚Äì15",
          tip:"Body rigid as a plank throughout. No sagging hips. Elevate hands on a bench to make it easier. Progress to feet-elevated when ready." },
        { id:"p3-b4", name:"Dumbbell Farmer Carry", sets:"3", reps:"30 m walk",
          tip:"Heavy dumbbells, one in each hand. Spine tall, shoulders back. Builds total-body stiffness and grip. One of the best bang-for-buck exercises in existence." },
        { id:"p3-b5", name:"Pallof Press (Band)", sets:"3", reps:"12 each side",
          tip:"Increase band resistance from Phase 2. Can now do a slightly more lateral anchor point for a different challenge angle." },
      ]},
      { id:"p3-c", name:"Session C ‚Äî Full Body", emoji:"‚ö°", exercises:[
        { id:"p3-c1", name:"Trap Bar Deadlift", sets:"4", reps:"6‚Äì8",
          tip:"More spine-friendly than a barbell deadlift ‚Äî handles allow an upright torso. Keep chest up, push the floor away. Add weight each week." },
        { id:"p3-c2", name:"Bulgarian Split Squat", sets:"3", reps:"8 each side",
          tip:"Rear foot on a bench or chair, dumbbells in hands. Single-leg strength plus hip mobility. One of the most transferable exercises to snowboarding." },
        { id:"p3-c3", name:"Band Rotational Chop", sets:"3", reps:"12 each side",
          tip:"Band anchored to door at shoulder height. Rotate through the hips ‚Äî not just the arms. Replaces cable woodchop exactly. Builds the rotational power you need for turns." },
        { id:"p3-c4", name:"Suitcase Carry", sets:"3", reps:"30 m walk",
          tip:"One heavy dumbbell in one hand only. Walk tall, don't lean. Anti-lateral flexion ‚Äî trains the spine to resist sideways forces." },
        { id:"p3-c5", name:"Copenhagen Plank", sets:"3", reps:"20 sec each side",
          tip:"Side plank with the top foot resting on a bench or chair. Hip adductor and lateral core combined. Builds the hip strength needed for edge control on snow." },
      ]}
    ]
  },
  {
    id:4, name:"Phase 4", subtitle:"Power & Snowboard Prep", weeks:"Weeks 13‚Äì18",
    color:"#C4793A", emoji:"üèÇ",
    sessions:[
      { id:"p4-snow", name:"Snowboard Conditioning", emoji:"üèÇ", exercises:[
        { id:"p4-s1", name:"Box Jump", sets:"4", reps:"5",
          tip:"Land SOFTLY ‚Äî bend knees and hips to absorb impact. Step down, don't jump down. Start with a low box. If the back flares, regress to squat-to-stand first." },
        { id:"p4-s2", name:"Lateral Bound", sets:"4", reps:"8 each side",
          tip:"Push explosively off one foot sideways, land on the other and absorb. Directly mimics heel-to-toe edge transitions on a snowboard." },
        { id:"p4-s3", name:"Jump Squat", sets:"3", reps:"8",
          tip:"Bodyweight only. Explode up, land softly with soft knees. If there's any back pain, go back to wall sits and build more base first." },
        { id:"p4-s4", name:"Deficit Split Squat", sets:"4", reps:"8 each side",
          tip:"Front foot elevated on a weight plate or step. Deeper range. Builds hip mobility under load ‚Äî essential for the deep-flex snowboard stance." },
        { id:"p4-s5", name:"Med Ball Rotational Throw", sets:"3", reps:"10 each side",
          tip:"Stand side-on to a wall. Rotate hard from the hips and throw the ball at the wall, catch on rebound. This is where snowboard turning power comes from." },
        { id:"p4-s6", name:"Single-Leg RDL", sets:"3", reps:"10 each side",
          tip:"Dumbbell in the opposite hand. Slow and controlled. Balance plus posterior chain load. Essential for variable and uneven terrain." },
        { id:"p4-s7", name:"Bosu Balance", sets:"3", reps:"60 sec",
          tip:"Single-leg balance on the dome side. Eyes closed for extra challenge. Proprioceptive training ‚Äî directly mimics the unstable, shifting snow surface." },
        { id:"p4-s8", name:"Kettlebell Swing", sets:"4", reps:"12",
          tip:"Hip hinge at the bottom, explosive hip extension drives the swing ‚Äî NOT your arms. One of the best exercises for the lower body power you need on a snowboard." },
      ]}
    ]
  },
  {
    id:5, name:"Phase 5", subtitle:"Return to Snow", weeks:"Week 19+",
    color:"#3A8CB5", emoji:"‚ùÑÔ∏è",
    sessions:[
      { id:"p5-maintain", name:"Maintenance & Return", emoji:"üéø", exercises:[
        { id:"p5-m1", name:"Strength Training", sets:"3√ó/week", reps:"Phase 3 volume",
          tip:"Never stop entirely between seasons. Most disc recurrences happen in the off-season when people de-train. Keep the Phase 3 lifts in rotation year-round." },
        { id:"p5-m2", name:"Daily Walk", sets:"Daily", reps:"30 min",
          tip:"Make this permanent. Your disc health depends on daily low-load movement regardless of whether you're snowboarding or not." },
        { id:"p5-m3", name:"Morning Mobility", sets:"Daily", reps:"15 min",
          tip:"McKenzie press-ups, hip flexor stretch, hip circles. Takes 15 minutes. Do this every day for the rest of your life ‚Äî it's the cheapest insurance you have." },
      ]}
    ]
  }
];

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STORAGE_KEY = "rehab-tracker-v3";
let S = {
  phase: 0, session: 0, view: "today",
  expanded: null, logs: {},
  logEx: null, logPain: 0, logDiff: 0,
  p2BonusSeed: Date.now()  // seed for daily bonus pick ‚Äî reshuffle on demand
};

const todayKey = () => new Date().toISOString().split("T")[0];
const logKey   = id => `${todayKey()}__${id}`;
const loadLogs = () => { try { const d = localStorage.getItem(STORAGE_KEY); if (d) S.logs = JSON.parse(d); } catch(e){} };
const saveLogs = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(S.logs));

// Helper: find exercise object across all phases
function findEx(id) {
  for (const p of PHASES) for (const s of p.sessions) for (const e of s.exercises) if (e.id === id) return { ex: e, phase: p };
  // also search bonus pools
  for (const p of PHASES) if (p.bonusPool) for (const e of p.bonusPool) if (e.id === id) return { ex: e, phase: p };
  return null;
}

// Seeded shuffle ‚Äî picks N items from an array reproducibly given a seed
function seededPick(arr, n, seed) {
  // Simple mulberry32 seeded PRNG
  let s = seed >>> 0;
  function rand() { s += 0x6D2B79F5; let t = Math.imul(s ^ s >>> 15, 1 | s); t ^= t + Math.imul(t ^ t >>> 7, 61 | t); return ((t ^ t >>> 14) >>> 0) / 4294967296; }
  const pool = [...arr];
  const out  = [];
  while (out.length < n && pool.length) {
    const i = Math.floor(rand() * pool.length);
    out.push(pool.splice(i, 1)[0]);
  }
  return out;
}

// Get the 3 exercises for today's Phase 2 session (from full pool of 18)
function getP2Session() {
  const ph = PHASES.find(p => p.id === 2);
  if (!ph || !ph.bonusPool) return [];
  return seededPick(ph.bonusPool, 3, S.p2BonusSeed);
}

function shuffleP2() {
  S.p2BonusSeed = Date.now() + Math.floor(Math.random() * 99999);
  S.expanded = null;
  renderExercises();
  renderProgress();
}

// ‚îÄ‚îÄ‚îÄ PHASE COLOR HELPER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function colorVars(c) {
  document.documentElement.style.setProperty('--pc', c);
}
const alpha = (c, a) => c + a; // append hex alpha

// ‚îÄ‚îÄ‚îÄ VIDEO HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function ytSearchURL(q) {
  return `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`;
}

// Video button HTML + optional inline photo illustration + instructions from DB
function thumbHTML(exId, phaseColor, exName) {
  const dbEntry = dbLookup(exName);
  let illusHtml = '';
  let instrHtml = '';

  if (dbEntry && dbEntry.images && dbEntry.images.length >= 2) {
    const labels = ['Start', 'End'];
    const imgTags = dbEntry.images.slice(0, 2).map((url, i) => `
      <div style="flex:1;min-width:0;text-align:center;">
        <div style="font-size:10px;color:#7dd3c8;font-weight:700;letter-spacing:1px;margin-bottom:4px;text-transform:uppercase;">${labels[i]}</div>
        <img src="${url}"
          onerror="this.parentElement.style.display='none'"
          alt="${labels[i]}"
          style="width:100%;border-radius:8px;display:block;object-fit:cover;max-height:160px;background:#1e293b;" />
      </div>`).join('');
    illusHtml = `<div style="display:flex;gap:8px;margin-bottom:10px;padding:10px;background:#0f172a;border-radius:12px;border:1px solid #1e293b;">${imgTags}</div>`;
  }

  if (dbEntry && dbEntry.instructions && dbEntry.instructions.length) {
    const steps = dbEntry.instructions.map((step, i) =>
      `<li style="margin-bottom:6px;color:#aaa;font-size:13px;line-height:1.5;">${step}</li>`
    ).join('');
    instrHtml = `
      <div style="margin-bottom:12px;padding:12px;background:#0a0a18;border-radius:10px;border:1px solid #1a1a2e;">
        <div style="font-size:10px;color:#7dd3c8;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px;">üìã Step-by-Step</div>
        <ol style="margin:0;padding-left:18px;">${steps}</ol>
      </div>`;
  }

  const v   = VIDEOS[exId];
  const tid = THUMB_IDS[exId];
  if (!v) return illusHtml + instrHtml;
  if (!tid) {
    const searchURL = ytSearchURL(v.q);
    return `<div class="vid-thumb-wrap">${illusHtml}${instrHtml}
      <a class="vid-fallback" href="${searchURL}" target="_blank" rel="noopener">
        üîç Search "${v.label}" on YouTube
      </a>
    </div>`;
  }
  return `
    <div class="vid-thumb-wrap" data-ex="${exId}" data-color="${phaseColor}">
      ${illusHtml}${instrHtml}
      <button class="vid-watch-btn" onclick="playVideo('${exId}','${phaseColor}')"
        style="display:flex;align-items:center;gap:10px;width:100%;padding:14px 18px;
               border-radius:12px;border:none;cursor:pointer;
               background:#1a1a2e;color:#fff;font-size:15px;font-weight:600;
               box-shadow:0 2px 12px rgba(0,0,0,0.3);">
        <span style="display:inline-flex;align-items:center;justify-content:center;
                     width:38px;height:38px;border-radius:50%;flex-shrink:0;
                     background:${phaseColor};box-shadow:0 2px 8px ${phaseColor}88;font-size:16px;">‚ñ∂</span>
        <span>Watch Demo</span>
      </button>
    </div>`;
}



// Play video in modal
function playVideo(exId, phaseColor) {
  const v   = VIDEOS[exId];
  const tid = THUMB_IDS[exId];
  if (!v) return;
  if (!tid) { window.open(ytSearchURL(v.q), '_blank'); return; }
  document.getElementById('vid-modal-title').textContent = v.label;
  document.getElementById('vid-frame').style.boxShadow = `0 0 40px ${phaseColor}44`;
  document.getElementById('vid-frame').innerHTML =
    `<iframe src="https://www.youtube.com/embed/${tid}?autoplay=1&rel=0&modestbranding=1"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen></iframe>`;
  document.getElementById('vid-modal').classList.add('open');
}

// Quick-play button in exercise row
function quickPlay(exId, phaseColor) {
  playVideo(exId, phaseColor);
}

// ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function applyPhaseTheme() {
  const p = PHASES[S.phase];
  colorVars(p.color);
  const badge = document.getElementById('phase-badge');
  badge.style.cssText = `background:${p.color}22;border:1px solid ${p.color}44;border-radius:10px;padding:6px 12px;text-align:center;`;
  document.getElementById('badge-sub').style.color  = p.color;
  document.getElementById('badge-name').style.color = p.color;
  document.getElementById('badge-name').textContent = p.name;
  document.querySelectorAll('.nav-tab').forEach(t => {
    const active = t.dataset.view === S.view;
    t.style.borderBottomColor = active ? p.color : 'transparent';
    t.style.color = active ? p.color : '#555';
  });
}

function renderPhasePills() {
  document.getElementById('phase-selector').innerHTML = PHASES.map((p, i) =>
    `<button class="phase-btn" onclick="selectPhase(${i})"
      style="${i===S.phase ? `background:${p.color};border-color:${p.color};color:#fff;` : ''}"
    >${p.name}</button>`
  ).join('');
}

function renderSessionTabs() {
  const p  = PHASES[S.phase];
  const el = document.getElementById('session-tabs');
  if (p.sessions.length <= 1) { el.innerHTML = ''; el.style.display = 'none'; return; }
  el.style.display = 'flex';
  el.innerHTML = p.sessions.map((s, i) =>
    `<button class="session-tab ${i===S.session?'active':''}"
      style="${i===S.session ? `border-color:${p.color}66;` : ''}"
      onclick="selectSession(${i})">${s.emoji} ${s.name}</button>`
  ).join('');
}

function renderProgress() {
  const p    = PHASES[S.phase];
  const sess = p.sessions[S.session];
  const allEx = (p.id === 2) ? getP2Session() : sess.exercises;
  const done = allEx.filter(e => !!S.logs[logKey(e.id)]).length;
  const tot  = allEx.length;
  const pct  = tot ? Math.round(done / tot * 100) : 0;
  document.getElementById('prog-label').textContent = `${sess.emoji} ${sess.name}`;
  const cnt = document.getElementById('prog-count');
  cnt.textContent = `${done}/${tot} done`;
  cnt.style.color = p.color;
  const fill = document.getElementById('prog-fill');
  fill.style.width      = `${pct}%`;
  fill.style.background = `linear-gradient(90deg, ${p.color}, ${p.color}BB)`;
}

function renderExercises() {
  const p    = PHASES[S.phase];
  const sess = p.sessions[S.session];

  function exCardHTML(ex) {
    const log     = S.logs[logKey(ex.id)];
    const checked = !!log;
    const open    = S.expanded === ex.id;
    const hasV    = !!VIDEOS[ex.id];
    const painCol = log && log.pain > 0
      ? (log.pain <= 3 ? '#4A9B8E' : log.pain <= 6 ? '#E8A838' : '#C94F4F') : '';

    const chips = log && (log.sets || log.pain > 0) ? `
      <div class="log-chips">
        ${log.sets  ? `<span class="log-chip">${log.sets} √ó ${log.reps}</span>` : ''}
        ${log.pain > 0 ? `<span class="log-chip" style="color:${painCol}">Pain: ${log.pain}/10</span>` : ''}
        ${log.difficulty > 0 ? `<span class="log-chip">Effort: ${['','Easy','Light','Mod','Hard','Max'][log.difficulty]}</span>` : ''}
      </div>` : '';

    return `
      <div class="ex-card" style="${checked ? `border-color:${p.color}44;background:${p.color}18;` : ''}">
        <div class="ex-row">
          <button class="ex-check" onclick="toggleCheck('${ex.id}')"
            style="${checked ? `border-color:${p.color};background:${p.color};color:#fff;` : ''}">
            ${checked ? '‚úì' : ''}
          </button>
          <div class="ex-info">
            <div class="ex-name" style="${checked ? 'color:#fff;' : ''}">${ex.name}</div>
            <div class="ex-meta">${ex.sets} sets ¬∑ ${ex.reps}</div>
          </div>
          <div class="ex-btns">
            <button class="ex-btn" onclick="toggleExpand('${ex.id}')"
              style="${open ? `border-color:${p.color}66;background:${p.color}22;color:${p.color};` : ''}">
              ${open ? '‚ñ≤' : '‚ñº'}
            </button>
            ${hasV ? `
            <button class="ex-btn" title="Watch video"
              onclick="quickPlay('${ex.id}','${p.color}')"
              style="border-color:${p.color}44;background:${p.color}22;color:${p.color};font-weight:700;">
              ‚ñ∂
            </button>` : ''}
            <button class="ex-btn" onclick="openLog('${ex.id}')"
              style="${log && log.sets ? `border-color:${p.color}44;background:${p.color}22;color:${p.color};` : ''}">
              üìä
            </button>
          </div>
        </div>
        <div class="ex-panel ${open ? 'open' : ''}">
          <div class="ex-tip" style="border-left-color:${p.color};">üí° ${ex.tip}</div>
          ${thumbHTML(ex.id, p.color, ex.name)}
        </div>
        ${chips}
      </div>`;
  }

  const exercises = (p.id === 2) ? getP2Session() : sess.exercises;

  const listHTML = exercises.map(ex => exCardHTML(ex)).join('');

  const shuffleBar = (p.id === 2) ? `
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
      <div style="font-size:11px;color:#666;letter-spacing:1px;text-transform:uppercase;flex:1;">
        üé≤ Daily draw ¬∑ 3 of ${p.bonusPool.length} exercises
      </div>
      <button onclick="shuffleP2()" style="font-size:12px;padding:6px 12px;border-radius:8px;border:1px solid #2A2A3A;background:#1A1A2E;color:${p.color};cursor:pointer;font-family:inherit;font-weight:600;">
        ‚Ü∫ Shuffle
      </button>
    </div>` : '';

  document.getElementById('exercise-list').innerHTML = shuffleBar + listHTML;
}

function renderPhasesView() {
  document.getElementById('phases-list').innerHTML = PHASES.map((p, i) => {
    const total = p.sessions.reduce((a, s) => a + s.exercises.length, 0);
    return `
      <button class="phase-card" onclick="selectPhaseAndGo(${i})"
        style="border-color:${i===S.phase ? p.color+'66' : '#1E1E30'};">
        <div class="phase-icon" style="background:${p.color}22;border:1px solid ${p.color}44;">${p.emoji}</div>
        <div class="phase-card-body">
          <div class="phase-card-top">
            <span class="phase-card-name">${p.name}</span>
            <span class="phase-weeks" style="color:${p.color};background:${p.color}22;">${p.weeks}</span>
          </div>
          <div class="phase-card-sub">${p.subtitle}</div>
          <div class="phase-card-count">${total} exercises ¬∑ ${p.sessions.length} session${p.sessions.length > 1 ? 's' : ''}</div>
        </div>
        <span style="color:#333;font-size:18px;">‚Ä∫</span>
      </button>`;
  }).join('');
}

function renderHistory() {
  const p       = PHASES[S.phase];
  const today   = todayKey();
  // Calendar strip
  const days = Array.from({length:14}, (_, i) => {
    const d = new Date(); d.setDate(d.getDate() - (13 - i));
    const k = d.toISOString().split("T")[0];
    const n = Object.keys(S.logs).filter(l => l.startsWith(k + '__')).length;
    return { k, d, n };
  });
  document.getElementById('cal-strip').innerHTML = days.map(({k, d, n}) => {
    const isToday = k === today;
    return `<div class="cal-day"
      style="${n > 0 ? `background:${p.color}33;` : ''}border-color:${isToday ? p.color : n > 0 ? p.color+'44' : '#1E1E30'};">
      <div class="cal-weekday">${d.toLocaleDateString('en',{weekday:'narrow'})}</div>
      <div class="cal-num" style="color:${isToday ? p.color : n > 0 ? '#fff' : '#444'};">${d.getDate()}</div>
      <div class="cal-count" style="color:${p.color};">${n > 0 ? n : '¬∑'}</div>
    </div>`;
  }).join('');

  // History list
  const entries = Object.entries(S.logs)
    .sort((a, b) => (b[1].ts||0) - (a[1].ts||0))
    .slice(0, 20)
    .map(([k, log]) => {
      const [dateStr, exId] = k.split('__');
      const found = findEx(exId);
      if (!found) return null;
      const { ex, phase: ph } = found;
      const painCol = log.pain > 0 ? (log.pain<=3?'#4A9B8E':log.pain<=6?'#E8A838':'#C94F4F') : '';
      const dateLabel = new Date(dateStr + 'T12:00:00').toLocaleDateString('en', {month:'short', day:'numeric'});
      return `
        <div class="history-item">
          <div class="history-dot" style="background:${ph.color};"></div>
          <div style="flex:1;min-width:0;">
            <div class="history-name">${ex.name}</div>
            <div class="history-meta">${dateLabel}${log.sets ? ` ¬∑ ${log.sets}√ó${log.reps}` : ''}${log.pain > 0 ? ` ¬∑ Pain ${log.pain}/10` : ''}</div>
          </div>
          ${log.pain > 0 ? `<span style="font-size:12px;font-weight:700;color:${painCol};flex-shrink:0;">${log.pain}/10</span>` : ''}
        </div>`;
    }).filter(Boolean);

  document.getElementById('history-list').innerHTML = entries.length
    ? entries.join('')
    : `<div class="empty-state">No sessions logged yet.<br><span style="color:#555;">Start checking off exercises on Today.</span></div>`;
}

function renderAll() {
  applyPhaseTheme();
  renderPhasePills();
  renderSessionTabs();
  renderProgress();
  renderExercises();
  renderPhasesView();
  renderHistory();
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(`view-${S.view}`).classList.add('active');
  applyPhaseTheme(); // re-apply after nav tab rerender
}

// ‚îÄ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectPhase(i)       { S.phase = i; S.session = 0; S.expanded = null; renderAll(); }
function selectPhaseAndGo(i)  { S.phase = i; S.session = 0; S.expanded = null; S.view = 'today'; renderAll(); }
function selectSession(i)     { S.session = i; S.expanded = null; renderProgress(); renderExercises(); }
function toggleExpand(id)     { S.expanded = S.expanded === id ? null : id; renderExercises(); }

function toggleCheck(id) {
  const k = logKey(id);
  if (S.logs[k]) delete S.logs[k];
  else S.logs[k] = { done: true, ts: Date.now() };
  saveLogs();
  renderProgress();
  renderExercises();
}

// ‚îÄ‚îÄ‚îÄ VIDEO MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function closeVideo() {
  document.getElementById('vid-modal').classList.remove('open');
  document.getElementById('vid-frame').innerHTML = '';
}
document.getElementById('vid-close').onclick = closeVideo;
document.getElementById('vid-modal').onclick = e => { if (e.target === document.getElementById('vid-modal')) closeVideo(); };

// ‚îÄ‚îÄ‚îÄ LOG MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openLog(exId) {
  const found = findEx(exId);
  if (!found) return;
  const { ex, phase: ph } = found;
  const log = S.logs[logKey(exId)] || {};
  S.logEx = ex; S.logPain = log.pain || 0; S.logDiff = log.difficulty || 0;

  document.getElementById('log-title').textContent = ex.name;
  document.getElementById('log-sub').textContent   = `Target: ${ex.sets} sets ¬∑ ${ex.reps}`;
  document.getElementById('log-sets').value        = log.sets || '';
  document.getElementById('log-sets').placeholder  = ex.sets;
  document.getElementById('log-reps').value        = log.reps || '';
  document.getElementById('log-reps').placeholder  = ex.reps;
  document.getElementById('log-notes').value       = log.notes || '';
  document.getElementById('save-btn').style.background = ph.color;

  renderPainDots(ph.color);
  renderDiffBtns(ph.color);
  document.getElementById('log-modal').classList.add('open');
}

function renderPainDots(phColor) {
  document.getElementById('pain-dots').innerHTML = Array.from({length:11}, (_, n) => {
    const on  = n <= S.logPain;
    const col = on ? (n<=3?'#4A9B8E':n<=6?'#E8A838':'#C94F4F') : '#2A2A3A';
    return `<button class="pain-dot" onclick="setPain(${n})"
      style="background:${col};color:${on?'#fff':'#555'};${n===S.logPain?'transform:scale(1.2);':''}">${n}</button>`;
  }).join('');
}

function renderDiffBtns(phColor) {
  const ph = PHASES[S.phase];
  document.getElementById('diff-row').innerHTML =
    ['Easy','Light','Mod','Hard','Max'].map((label, i) => {
      const n  = i + 1;
      const on = n <= S.logDiff;
      return `<button class="diff-btn" onclick="setDiff(${n})"
        style="${on ? `background:${ph.color};color:#fff;` : ''}">${label}</button>`;
    }).join('');
}

function setPain(n) { S.logPain = n; renderPainDots(); }
function setDiff(n) { S.logDiff = n; renderDiffBtns(); }

function closeLog() { document.getElementById('log-modal').classList.remove('open'); S.logEx = null; }
document.getElementById('log-close').onclick = closeLog;
document.getElementById('log-modal').onclick  = e => { if (e.target === document.getElementById('log-modal')) closeLog(); };
document.getElementById('log-modal-inner').onclick = e => e.stopPropagation();

document.getElementById('save-btn').onclick = () => {
  if (!S.logEx) return;
  S.logs[logKey(S.logEx.id)] = {
    done: true, ts: Date.now(),
    sets: document.getElementById('log-sets').value,
    reps: document.getElementById('log-reps').value,
    pain: S.logPain, difficulty: S.logDiff,
    notes: document.getElementById('log-notes').value,
  };
  saveLogs();
  closeLog();
  renderProgress(); renderExercises(); renderHistory();
  showToast();
};

function showToast() {
  const t = document.getElementById('toast');
  t.classList.remove('show');
  void t.offsetWidth;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 1700);
}

// ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.onclick = () => { S.view = tab.dataset.view; renderAll(); };
});

// ‚îÄ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
loadLogs();
renderAll();
loadExerciseDB(); // async ‚Äî re-renders when done
</script>
</body>
</html>
